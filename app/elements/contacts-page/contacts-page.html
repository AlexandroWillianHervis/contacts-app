<link rel="import" href="../elements.shared.html">
<link rel="import" href="../../bower_components/core-list/core-list.html">
<link rel="import" href="../../bower_components/core-image/core-image.html">

<!--
  TODO:
  - Alphabetical grouping
-->

<polymer-element name="contacts-page" attributes="contacts">
  <template>
    <link rel="stylesheet" href="contacts-page.css">

    <core-drawer-panel id="drawerPanel">

      <!-- Drawer -->
      <core-header-panel drawer>
        <core-toolbar>Menu</core-toolbar>
      </core-header-panel>

      <!-- Main -->
      <div main>
        <core-scroll-header-panel id="scrollHeader" condenses fit>
          <core-toolbar class="tall">
            <core-icon-button id="btnMenu" icon="menu"
                              on-tap="{{$.drawerPanel.togglePanel}}">
            </core-icon-button>
            <div id="title" class="bottom indent">All Contacts</div>
          </core-toolbar>
          <div content>
            <core-list id="list" data="{{contacts}}"
                                 scrollTarget="{{$.scrollHeader.scroller}}">
              <template>
                <a href="/#/contacts/{{index}}">
                  <div class="row" layout horizontal center>
                    <core-image src="{{model.avatar}}" preload sizing="cover">
                    </core-image>
                    <div flex>{{model.name}}</div>
                  </div>
                </a>
              </template>
            </core-list>
          </div>
        </core-scroll-header-panel>

        <!-- Add contact -->
        <a href="/#/add">
          <paper-fab icon="add"></paper-fab>
        </a>
      </div>
    </core-drawer-panel>
  </template>
  <script>
  (function() {
    Polymer({
      domReady: function() {
        // custom transformation: scale header's title
        var titleStyle = this.$.title.style;
        document.addEventListener('core-header-transform', function(e) {
          var d = e.detail;
          var m = d.height - d.condensedHeight;
          var scale = Math.max(0.55, (m - d.y) / (m / 0.25)  + 0.55);
          titleStyle.transform = titleStyle.webkitTransform =
              'scale(' + scale + ') translateZ(0)';
        });
      },
      willPrepare: function() {
        this.$.scrollHeader.measureHeaderHeight();
      }
    });
  })();
  </script>
</polymer-element>
