<link rel="import" href="../elements.shared.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/core-icons/communication-icons.html">

<!--
TODO:
Use core-media-query to switch to a [cover] core-header-panel on desktop
 -->

<polymer-element name="info-page" attributes="contactId contacts" layout vertical>
  <template>
    <link rel="stylesheet" href="info-page.css">

    <core-scroll-header-panel id="scrollHeader" condenses flex>
      <core-toolbar class="tall">
        <a href="/#/">
          <paper-icon-button icon="arrow-back"></paper-icon-button>
        </a>
        <div id="title" class="bottom indent">{{contacts[contactId].name}}</div>
      </core-toolbar>
      <div content>

        <!-- Phone -->
        <div class="group">
          <div class="item">
            <core-icon icon="communication:phone"></core-icon>
            <div class="double-line-1">(315) 546-0060</div>
            <div class="double-line-2">Home</div>
          </div>
          <div class="item">
            <div class="double-line-1">(675) 233-8464</div>
            <div class="double-line-2">Work</div>
          </div>
          <div class="item">
            <div class="double-line-1">(797) 158-2516</div>
            <div class="double-line-2">Cell</div>
          </div>
        </div>

        <!-- Email -->
        <div class="group">
          <div class="item">
            <core-icon icon="mail"></core-icon>
            <div class="double-line-1">(315) 546-0060</div>
            <div class="double-line-2">Home</div>
          </div>
          <div class="item">
            <div class="double-line-1">(675) 233-8464</div>
            <div class="double-line-2">Work</div>
          </div>
          <div class="item">
            <div class="double-line-1">(797) 158-2516</div>
            <div class="double-line-2">Cell</div>
          </div>
        </div>

        <!-- Location -->
        <div class="group">
          <div class="item">
            <core-icon icon="room"></core-icon>
            <div class="double-line-1">(315) 546-0060</div>
            <div class="double-line-2">Home</div>
          </div>
          <div class="item">
            <div class="double-line-1">(675) 233-8464</div>
            <div class="double-line-2">Work</div>
          </div>
          <div class="item">
            <div class="double-line-1">(797) 158-2516</div>
            <div class="double-line-2">Cell</div>
          </div>
        </div>
      </div>
    </core-scroll-header-panel>
  </template>
  <script>
  (function() {
    Polymer({
      domReady: function() {
        // custom transformation: scale header's title
        var titleStyle = this.$.title.style;
        document.addEventListener('core-header-transform', function(e) {
          var d = e.detail;
          var m = d.height - d.condensedHeight;
          var scale = Math.max(0.55, (m - d.y) / (m / 0.25) + 0.55);
          titleStyle.transform = titleStyle.webkitTransform =
            'scale(' + scale + ') translateZ(0)';
        });
      },
      willPrepare: function() {
        this.$.scrollHeader.measureHeaderHeight();
      },
      // Apply the contact's photo as a header background image.
      // Use multiple backgrounds to create an inset box shadow look
      // that doesn't cause scroll jank
      contactIdChanged: function(oldVal, newVal) {
        // Unfortunately this approach also causes scroll jank :(
        // Going with the regular background image until I can find a solution
        // this.$.scrollHeader.shadowRoot.querySelector('#headerBg')
        //   .style['background'] = 'url(/images/header-shadow.png) repeat-x,'+
        //                          'url('+this.contacts[newVal].avatar+') 0 / cover no-repeat';
        this.$.scrollHeader.shadowRoot.querySelector('#headerBg')
          .style['background'] = 'url('+this.contacts[newVal].avatar+') 0 / cover no-repeat';
      }
    });
  })();
  </script>
</polymer-element>
